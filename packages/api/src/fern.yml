ids:
  - name: FernFilepath
    docs: A filepath to a Fern spec file, excluding the file extension

types:
  IntermediateRepresentation:
    docs: Complete representation of the API schema
    fields:
      types:
        docs: The types described by this API
        type: list<TypeDefinition>
      errors: list<ErrorDefinition>
      services:
        docs: The services exposed by this API
        type: Services

  TypeDefinition:
    docs: A type, which is a name and a shape
    extends: WithDocs
    fields:
      name: NamedType
      shape: Type

  WithDocs:
    fields:
      docs: optional<string>

  NamedType:
    fields:
      name: string
      fernFilepath: FernFilepath

  Type:
    union:
      object: ObjectTypeDefinition
      union: UnionTypeDefinition
      alias: AliasTypeDefinition
      enum: EnumTypeDefinition

  ObjectTypeDefinition:
    fields:
      extends:
        docs: A list of other types to inherit from
        type: list<NamedType>
      properties: list<ObjectProperty>

  ObjectProperty:
    extends: WithDocs
    fields:
      key: string
      valueType: TypeReference

  TypeReference:
    union:
      named: NamedType
      primitive: PrimitiveType
      container: ContainerType
      void: {}

  PrimitiveType:
    enum:
      - INTEGER
      - DOUBLE
      - STRING
      - BOOLEAN
      - value: LONG
        docs: Within the range -2^53 to 2^53

  ContainerType:
    union:
      map: MapType
      list: TypeReference
      set: TypeReference
      optional: TypeReference

  MapType:
    fields:
      keyType: TypeReference
      valueType: TypeReference

  UnionTypeDefinition:
    fields:
      discriminant: string
      types: list<SingleUnionType>

  SingleUnionType:
    extends: WithDocs
    fields:
      discriminantValue: string
      valueType: TypeReference

  AliasTypeDefinition:
    fields:
      aliasOf: TypeReference
      isId: boolean

  EnumTypeDefinition:
    fields:
      values: list<EnumValue>

  EnumValue:
    extends: WithDocs
    fields:
      name:
        type: string
        docs: Name is an alphanumeric way to reference this enum. Useful for code generation.
      value: string

  ErrorDefinition:
    extends: WithDocs
    fields:
      name: NamedError
      http: optional<HttpErrorConfiguration>
      properties: list<ErrorProperty>

  ErrorProperty:
    extends: WithDocs
    fields:
      name: string
      type: TypeReference

  HttpErrorConfiguration:
    fields:
      statusCode: integer

  NamedError:
    fields:
      name: string
      fernFilepath: FernFilepath

  ErrorReference:
    extends: WithDocs
    fields:
      discriminantValue: string
      error: NamedError

  Services:
    fields:
      http: list<HttpService>
      websocket: list<WebSocketService>

  HttpService:
    extends: BaseService
    fields:
      headers: list<HttpHeader>
      endpoints: list<HttpEndpoint>

  HttpHeader:
    extends: WithDocs
    fields:
      header: string
      valueType: TypeReference

  HttpEndpoint:
    extends: WithDocs
    fields:
      endpointId: string
      method: HttpMethod
      path: string
      parameters: list<PathParameter>
      queryParameters: list<QueryParameter>
      headers: list<HttpHeader>
      request: optional<HttpRequest>
      response: optional<HttpResponse>
      errors: list<ErrorReference>

  HttpRequest:
    extends: WithDocs
    fields:
      bodyType: TypeReference

  HttpResponse:
    extends: WithDocs
    fields:
      bodyType: TypeReference

  HttpMethod:
    enum:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH

  WebSocketService:
    extends: BaseService
    fields:
      messages: list<WebSocketMessage>

  WebSocketMessage:
    extends: WithDocs
    fields:
      origin: WebSocketMessageOrigin
      body: optional<WebSocketMessageBody>
      response: optional<WebSocketMessageResponse>
      errors: list<ErrorReference>

  WebSocketMessageOrigin:
    enum:
      - CLIENT
      - SERVER

  WebSocketMessageBody:
    extends: WithDocs
    fields:
      bodyType: TypeReference

  WebSocketMessageResponse:
    extends: WithDocs
    fields:
      bodyType: TypeReference
      behavior:
        type: WebSocketMessageResponseBehavior
        docs: Defaults to {WebSocketMessageResponseBehavior.ONGOING}

  WebSocketMessageResponseBehavior:
    enum:
      - ONGOING
      - REQUEST_RESPONSE

  BaseService:
    extends: WithDocs
    fields:
      name: NamedType
      displayName: string
      basePath: string

  PathParameter:
    extends: WithDocs
    fields:
      key: string
      valueType: TypeReference

  QueryParameter:
    extends: WithDocs
    fields:
      key: string
      valueType: TypeReference
